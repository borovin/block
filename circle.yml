machine:
  node:
    version: stable
  environment:
    CODACY_REPO_TOKEN: dd8f0dc3c7d24fbd963ff90155a5873b

dependencies:
  post:
    - npm install karma-coverage karma-junit-reporter codacy-coverage

test:
  override:
    - npm test -- --reporters=coverage,junit,mocha
  post:
    - mkdir $CIRCLE_TEST_REPORTS/junit && mv reports/junit/*.xml $CIRCLE_TEST_REPORTS/junit
    - ./node_modules/codacy-coverage/bin/codacy-coverage.js < ./reporters/lcov.info